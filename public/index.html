<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iScribe - Bible Audio Transcription</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ iScribe</h1>
            <p>Convert Bible chapters to high-quality audio using Fish.Audio TTS</p>
        </header>

        <main>
            <!-- Configuration Section -->
            <section class="config-section">
                <h2>‚öôÔ∏è Configuration</h2>
                <div class="config-grid">
                    <div class="config-item">
                        <label for="fishApiKey">Fish.Audio API Key:</label>
                        <input type="password" id="fishApiKey" placeholder="Set in .env configuration file" readonly>
                        <small>‚ö†Ô∏è API key can only be changed in the .env configuration file for security</small>
                    </div>
                    <div class="config-item">
                        <label for="voiceModelId">Voice Model ID:</label>
                        <input type="text" id="voiceModelId" placeholder="Enter your custom voice model ID">
                        <small>The ID of your Fish.Audio custom voice model (can be changed here)</small>
                    </div>
                </div>
                <button id="saveConfig" class="btn btn-secondary">üíæ Save Voice Model ID</button>
                <div id="configStatus" class="status-message"></div>
                <div id="envConfigStatus" class="status-message" style="display: none;">
                    <strong>‚úÖ API Key loaded from environment file (.env)</strong>
                    <br><small>You can still change the Voice Model ID using the form above if needed.</small>
                </div>
            </section>

            <!-- Transcription Section -->
            <section class="transcription-section">
                <h2>üìñ Bible Transcription</h2>
                <div class="transcription-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="bibleBook">Bible Book:</label>
                            <select id="bibleBook">
                                <option value="">Select a book...</option>
                                <!-- Old Testament -->
                                <optgroup label="Old Testament">
                                    <option value="GEN">Genesis</option>
                                    <option value="EXO">Exodus</option>
                                    <option value="LEV">Leviticus</option>
                                    <option value="NUM">Numbers</option>
                                    <option value="DEU">Deuteronomy</option>
                                    <option value="JOS">Joshua</option>
                                    <option value="JDG">Judges</option>
                                    <option value="RUT">Ruth</option>
                                    <option value="1SA">1 Samuel</option>
                                    <option value="2SA">2 Samuel</option>
                                    <option value="1KI">1 Kings</option>
                                    <option value="2KI">2 Kings</option>
                                    <option value="1CH">1 Chronicles</option>
                                    <option value="2CH">2 Chronicles</option>
                                    <option value="EZR">Ezra</option>
                                    <option value="NEH">Nehemiah</option>
                                    <option value="EST">Esther</option>
                                    <option value="JOB">Job</option>
                                    <option value="PSA">Psalms</option>
                                    <option value="PRO">Proverbs</option>
                                    <option value="ECC">Ecclesiastes</option>
                                    <option value="SNG">Song of Songs</option>
                                    <option value="ISA">Isaiah</option>
                                    <option value="JER">Jeremiah</option>
                                    <option value="LAM">Lamentations</option>
                                    <option value="EZK">Ezekiel</option>
                                    <option value="DAN">Daniel</option>
                                    <option value="HOS">Hosea</option>
                                    <option value="JOL">Joel</option>
                                    <option value="AMO">Amos</option>
                                    <option value="OBA">Obadiah</option>
                                    <option value="JON">Jonah</option>
                                    <option value="MIC">Micah</option>
                                    <option value="NAH">Nahum</option>
                                    <option value="HAB">Habakkuk</option>
                                    <option value="ZEP">Zephaniah</option>
                                    <option value="HAG">Haggai</option>
                                    <option value="ZEC">Zechariah</option>
                                    <option value="MAL">Malachi</option>
                                </optgroup>
                                <!-- New Testament -->
                                <optgroup label="New Testament">
                                    <option value="MAT">Matthew</option>
                                    <option value="MRK">Mark</option>
                                    <option value="LUK">Luke</option>
                                    <option value="JHN">John</option>
                                    <option value="ACT">Acts</option>
                                    <option value="ROM">Romans</option>
                                    <option value="1CO">1 Corinthians</option>
                                    <option value="2CO">2 Corinthians</option>
                                    <option value="GAL">Galatians</option>
                                    <option value="EPH">Ephesians</option>
                                    <option value="PHP">Philippians</option>
                                    <option value="COL">Colossians</option>
                                    <option value="1TH">1 Thessalonians</option>
                                    <option value="2TH">2 Thessalonians</option>
                                    <option value="1TI">1 Timothy</option>
                                    <option value="2TI">2 Timothy</option>
                                    <option value="TIT">Titus</option>
                                    <option value="PHM">Philemon</option>
                                    <option value="HEB">Hebrews</option>
                                    <option value="JAS">James</option>
                                    <option value="1PE">1 Peter</option>
                                    <option value="2PE">2 Peter</option>
                                    <option value="1JN">1 John</option>
                                    <option value="2JN">2 John</option>
                                    <option value="3JN">3 John</option>
                                    <option value="JUD">Jude</option>
                                    <option value="REV">Revelation</option>
                                </optgroup>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="transcribeFullBook">
                                <span class="checkmark"></span>
                                Transcribe entire book (all chapters)
                            </label>
                            <small>Generate individual files for each chapter in the selected book</small>
                        </div>

                        <div class="form-group" id="chapterInputGroup">
                            <label for="chapter">Chapter:</label>
                            <div class="chapter-input-container">
                                <input type="number" id="chapter" min="1" placeholder="1">
                                <div class="chapter-validation" id="chapterValidation">
                                    <span class="validation-icon"></span>
                                    <span class="validation-message"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="version">Bible Version:</label>
                            <select id="version">
                                <option value="WEB" selected>WEB (World English Bible)</option>
                                <option value="NIV">NIV (New International Version)</option>
                                <option value="ESV">ESV (English Standard Version)</option>
                                <option value="KJV">KJV (King James Version)</option>
                                <option value="NASB">NASB (New American Standard Bible)</option>
                                <option value="NLT">NLT (New Living Translation)</option>
                                <option value="CSB">CSB (Christian Standard Bible)</option>
                                <option value="NKJV">NKJV (New King James Version)</option>
                                <option value="MSG">MSG (The Message)</option>
                                <option value="AMP">AMP (Amplified Bible)</option>
                                <option value="CEV">CEV (Contemporary English Version)</option>
                                <option value="HCSB">HCSB (Holman Christian Standard Bible)</option>
                                <option value="NASB1995">NASB1995 (New American Standard Bible 1995)</option>
                                <option value="NET">NET (New English Translation)</option>
                                <option value="RSV">RSV (Revised Standard Version)</option>
                                <option value="ASV">ASV (American Standard Version)</option>
                                <option value="YLT">YLT (Young's Literal Translation)</option>
                                <option value="DARBY">DARBY (Darby Translation)</option>
                                <option value="GNT">GNT (Good News Translation)</option>
                                <option value="NCV">NCV (New Century Version)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="maxSentences">Sentences per Audio Part:</label>
                            <input type="number" id="maxSentences" min="1" max="100" value="5" placeholder="5">
                            <small>Number of sentences per audio file. The entire chapter will be transcribed and split into multiple parts, then combined into one final MP3 with book/chapter introduction.</small>
                        </div>

                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="excludeVerseNumbers" checked disabled>
                                <span class="checkmark"></span>
                                Exclude verse numbers (always enabled)
                            </label>
                        </div>
                    </div>

                    <!-- Advanced TTS Override Section -->
                    <div class="advanced-tts-section">
                        <h3>üîß Manual Text Override</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="enableManualOverride">
                                    <span class="checkmark"></span>
                                    Use custom text instead of automatic Bible text
                                </label>
                                <small>Write or edit your own text for TTS processing</small>
                            </div>
                        </div>
                        
                        <div id="manualOverrideInterface" class="manual-override-interface" style="display: none;">
                            <!-- Step 1: Text Source Selection -->
                            <div class="override-step">
                                <h4>üìñ Step 1: Choose Text Source</h4>
                                <div class="text-source-options">
                                    <label class="source-option">
                                        <input type="radio" name="textSource" value="load" checked>
                                        <span class="source-radio"></span>
                                        <div class="source-content">
                                            <strong>Load from Bible API</strong>
                                            <small>Fetch text for selected book/chapter and edit it</small>
                                        </div>
                                    </label>
                                    <label class="source-option">
                                        <input type="radio" name="textSource" value="custom">
                                        <span class="source-radio"></span>
                                        <div class="source-content">
                                            <strong>Write Custom Text</strong>
                                            <small>Start with blank text and write your own</small>
                                        </div>
                                    </label>
                                </div>
                                
                                <div id="loadTextSection" class="load-text-section">
                                    <button type="button" id="loadChapterTextBtn" class="btn btn-primary">
                                        üìñ Load Chapter Text
                                    </button>
                                    <small>Click to fetch the Bible text for the selected book and chapter</small>
                                </div>
                            </div>
                            
                            <!-- Step 2: Text Editor -->
                            <div class="override-step">
                                <h4>‚úèÔ∏è Step 2: Edit Your Text</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="chapterIntroduction">Introduction Text:</label>
                                        <textarea id="chapterIntroduction" rows="2" placeholder="Text that will be spoken before the main content (e.g., 'Genesis, Chapter 1')"></textarea>
                                        <small>Customize the introduction text</small>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group full-width">
                                        <label for="chapterContent">Main Content Text:</label>
                                        <div class="text-editor-container">
                                            <div class="text-editor-toolbar">
                                                <button type="button" class="toolbar-btn" id="formatBold" title="Bold">B</button>
                                                <button type="button" class="toolbar-btn" id="formatItalic" title="Italic">I</button>
                                                <button type="button" class="toolbar-btn" id="formatUnderline" title="Underline">U</button>
                                                <button type="button" class="toolbar-btn" id="addPause" title="Add Pause (/) - 0.5 seconds">/</button>
                                                <button type="button" class="toolbar-btn" id="addLongPause" title="Add Long Pause (//) - 1 second">//</button>
                                                <button type="button" class="toolbar-btn" id="resetText" title="Reset to Original">üîÑ Reset</button>
                                                <button type="button" class="toolbar-btn" id="previewText" title="Preview Text">üëÅÔ∏è Preview</button>
                                            </div>
                                            <textarea id="chapterContent" rows="25" placeholder="Your text will appear here..."></textarea>
                                            <div class="text-stats">
                                                <span class="char-count">Characters: 0</span>
                                                <span class="word-count">Words: 0</span>
                                                <span class="sentence-count">Sentences: 0</span>
                                            </div>
                                        </div>
                                        <small>Edit the text as needed. Use / for 0.5-second pauses, // for 1-second pauses. Bold, italic, and underline formatting will be preserved in TTS.</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Step 3: TTS Settings -->
                            <div class="override-step">
                                <h4>‚öôÔ∏è Step 3: TTS Settings</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="maxSentencesOverride">Sentences per Audio Part:</label>
                                        <input type="number" id="maxSentencesOverride" min="1" max="100" value="5" placeholder="5">
                                        <small>Override the default sentence splitting</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="ttsSpeed">TTS Speed:</label>
                                        <select id="ttsSpeed">
                                            <option value="normal" selected>Normal</option>
                                            <option value="slow">Slow</option>
                                            <option value="fast">Fast</option>
                                            <option value="very-slow">Very Slow</option>
                                            <option value="very-fast">Very Fast</option>
                                        </select>
                                        <small>Adjust the speaking speed</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Video Creation Section -->
                    <div class="video-section">
                        <h3>üé¨ Video Creation (Optional)</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="createVideo">
                                    <span class="checkmark"></span>
                                    Create MP4 video with background image and synchronized text overlay
                                </label>
                                <small>Generate a video file with background image, audio, and follow-along Bible text that appears synchronized with the speech</small>
                            </div>
                        </div>
                        
                        <div id="imageUploadSection" class="image-upload-section" style="display: none;">
                            <div class="form-group">
                                <label for="backgroundImage">Background Image:</label>
                                <input type="file" id="backgroundImage" accept="image/*" class="file-input">
                                <small>Upload an image to use as the video background (JPEG, PNG, WebP supported, max 10MB)</small>
                            </div>
                            <div id="imagePreview" class="image-preview" style="display: none;">
                                <img id="previewImg" src="" alt="Background Preview">
                                <div class="image-info">
                                    <p id="imageInfo"></p>
                                    <button type="button" id="removeImage" class="btn btn-secondary btn-small">‚ùå Remove Image</button>
                                </div>
                            </div>
                            <div id="uploadProgress" class="upload-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <p class="upload-status">Uploading image...</p>
                            </div>
                        </div>
                    </div>

                    <button id="startTranscription" class="btn btn-primary">üé¨ Start Transcription</button>
                </div>
            </section>

            <!-- Queue Status Section -->
            <section class="queue-section" style="display: none;">
                <h2>üìã Job Queue</h2>
                <div class="queue-status">
                    <div class="queue-summary">
                        <span class="queue-count">0 jobs in queue</span>
                        <button id="refreshQueue" class="btn btn-secondary btn-small">üîÑ Refresh</button>
                    </div>
                    <div class="current-job" style="display: none;">
                        <h3>üîÑ Currently Processing</h3>
                        <div class="job-card current">
                            <div class="job-info">
                                <span class="job-title">Genesis 1 (NIV)</span>
                                <span class="job-status">Processing...</span>
                            </div>
                        </div>
                    </div>
                    <div class="queued-jobs" style="display: none;">
                        <h3>‚è≥ Queued Jobs</h3>
                        <div class="jobs-list"></div>
                    </div>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="progress-section" style="display: none;">
                <h2>üìä Current Job Progress</h2>
                <div class="progress-container">
                    <div class="progress-header">
                        <div class="progress-text">Ready to start...</div>
                        <div class="progress-percentage">0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-details"></div>
                </div>

                <div class="progress-log"></div>
            </section>

            <!-- Results Section -->
            <section class="results-section" style="display: none;">
                <h2>‚úÖ Results</h2>
                <div class="results-container">
                    <div class="result-item">
                        <p>Audio file generated successfully!</p>
                        <button id="downloadBtn" class="btn btn-success">üì• Download MP3</button>
                    </div>
                </div>
            </section>

            <!-- File Manager Section -->
            <section class="file-manager-section">
                <h2>üìÅ Media Files</h2>
                <div class="file-manager-controls">
                    <button id="refreshFiles" class="btn btn-secondary">üîÑ Refresh</button>
                    <button id="clearAll" class="btn btn-danger" style="margin-left: 10px;">üóëÔ∏è Clear All</button>
                </div>
                <div class="files-container">
                    <div class="loading-files" style="text-align: center; padding: 2rem;">
                        <p>Loading files...</p>
                    </div>
                </div>
                <div class="file-stats">
                    <p><strong>Total Files:</strong> <span id="totalFiles">0</span></p>
                    <p><strong>Total Size:</strong> <span id="totalSize">0 Bytes</span></p>
                </div>
            </section>
        </main>

        <footer>
            <p>üîä Creating seamless Bible audio with Fish.Audio TTS</p>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
